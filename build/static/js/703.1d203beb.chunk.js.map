{"version":3,"file":"static/js/703.1d203beb.chunk.js","mappings":"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","sources":["hooks/run.hook.ts","pages/GetAppls.tsx"],"sourcesContent":["import { useState } from \"react\";\n// import { useBeforeunload } from 'react-beforeunload';\n// import { IApplConfig } from \"../ts/applications\";\n// import { akt2json, genArr, log2csv, spliceIntoChunks } from \"../ts/utils\";\nimport useBtn from \"./btn.hook\";\n\n\ninterface IRun {\n    disabledDefault?: boolean;\n    convertDefault: boolean;\n    getZeroFunc: any;\n    type: \"pages\" | \"abits\";\n    handlerFunc: any;\n}\n\nconst useRun = ({\n    disabledDefault,\n    convertDefault,\n    getZeroFunc,\n    handlerFunc,\n    type\n}: IRun) => {\n    const [currAbit, sca] = useState(\"\");\n    const [status, ss] = useState(\"\");\n    const [counter, sc] = useState(\"\");\n    const [saveAt, setSaveAt] = useState(50);\n    const [resize, setResize] = useState(10);\n    const [convert, setConvert] = useState(convertDefault);\n\n    const [start, setStart] = useState(1);\n    const [end, setEnd] = useState(0);\n\n    const runBtn = useBtn(\"run\", \"RUN\", disabledDefault);\n\n    // const run = useCallback(async () => {\n    //     setCounter(\"\");\n    //     runBtn.disable();\n    //     runBtn.remove();\n\n    //     const logs = getZeroFunc(config) as L;\n\n    //     const fast = (resize === 1) ? \"\" : \"Fast\";\n\n    //     const { total, count_page } = await getPages(config);\n    //     const totalPages = genArr(count_page);\n    //     const splitedPages = spliceIntoChunks(totalPages, resize);\n\n    //     const limit = config.limit || 1;\n    //     let c = resize * limit;\n\n    //     for (const pages of splitedPages) {\n\n    //         if (c > total) c = total;\n    //         const p = Math.round(c / total * 10000) / 100;\n    //         setCounter(`${p}% (${c}/${total})`);\n\n    //         const toPromise: Promise<F>[] = [];\n    //         pages.forEach(page => toPromise.push(handlerFunc(page, { sca: setCurrAbit, ss: setStatus, config })));\n    //         await Promise.all(toPromise).then(localLogs => localLogs.flat().forEach(o => logs[o.id] = o));\n    //         if (c % saveAt === 0) {\n    //             runBtn.update(`${config.onlySogl ? \"\" : \"Full\"}ApplLog${c}.json`, akt2json(logs));\n    //         }\n\n    //         c += resize * limit;\n    //     }\n\n    //     const getBlob = (convert: boolean, logs: L) => {\n    //         if (convert) {\n    //             return [log2csv(logs), \"csv\"];\n    //         }\n    //         return [akt2json(logs), \"json\"];\n    //     };\n\n    //     const date = new Date();\n    //     const [data, ext] = (convert) ? [log2csv(logs), \"csv\"] : [akt2json(logs), \"json\"];\n    //     runBtn.update(`${config.onlySogl ? \"\" : \"Full\"}ApplLog${date.toISOString()}_${total}.${ext}`, data);\n    //     runBtn.enable();\n\n    // }, [runBtn, config, resize, convert, saveAt]);\n\n\n\n    return {\n        start, setStart,\n        end, setEnd,\n        currAbit, sca,\n        status, ss,\n        counter, sc,\n        saveAt, setSaveAt,\n        resize, setResize,\n        convert, setConvert,\n        runBtn\n    };\n};\n\nexport default useRun;","import React, { useCallback, useEffect, useState } from 'react';\nimport { ApplLog, applsChecks, checkAllAppls, genZeroAppl, getPages, IApplConfig, ILogAppFull } from \"../ts/applications\";\nimport { genArr, genUpdateFunc, spliceIntoChunks } from \"../ts/utils\";\nimport { sspvo_statuses } from \"../ts/getBigFuncs\";\nimport { CheckBox, SimpleSelect } from \"../components/SimpleSelect\";\nimport { MultiSelect, IMultiSelect } from \"../components/MultiSel\";\nimport { SingleSelect, ISingleSelect } from \"../components/MultiSel\";\nimport { SSPVOCodeStatuses } from \"../models/sspvo\";\nimport useRun from \"../hooks/run.hook\";\nimport MakeBtn from \"../components/MakeBtn\";\n\nconst defaultFilters: SSPVOCodeStatuses[] = [\"in_competition\"];\nconst defaultConfig: IApplConfig = {\n    fullCheck: false,\n    headers: false,\n    forceChange: false,\n    onlySogl: true,\n    limit: 100,\n    filters: \"\",\n    newStatus: null,\n    agree: \"\",\n    checks: [\"main\", \"sums\"]\n};\n\nconst CheckAppls: React.FC = () => {\n\n    const [config, setConfig] = useState(defaultConfig);\n    const [needNewStatus, setNeedNewStatus] = useState(false);\n\n    const {\n        currAbit, sca,\n        status, ss,\n        counter, sc,\n        saveAt, setSaveAt,\n        resize, setResize,\n        convert, setConvert,\n        runBtn\n    } = useRun({\n        convertDefault: false,\n        disabledDefault: false,\n        getZeroFunc: genZeroAppl,\n        type: \"pages\",\n        handlerFunc: checkAllAppls\n    });\n\n    useEffect(() => setConfig(prev => ({\n        ...prev, filters: defaultFilters.map(code => sspvo_statuses.filter(o => o.code === code).map(o => \"&filter_status=\" + o.id)).join(\"\"),\n    })), [setConfig]);\n\n    useEffect(() => {\n        document.title = (config.onlySogl) ? \"Согласия\" : \"Заявления\";\n        setConfig(prev => ({ ...prev, agree: (config.onlySogl) ? \"&filter_agree=true\" : \"\" }));\n    }, [config.onlySogl, setConfig]);\n\n    const start = useCallback(async () => {\n        sc(\"\");\n        runBtn.disable();\n        runBtn.remove();\n\n        const logs = genZeroAppl(config) as ILogAppFull;\n\n        const { total, count_page } = await getPages(config);\n        const totalPages = genArr(count_page);\n        const splitedPages = spliceIntoChunks(totalPages, resize);\n\n        const genLog = genUpdateFunc(\"ApplLog\", convert, resize, config.onlySogl);\n\n        let c = resize * config.limit;\n\n        for (const pages of splitedPages) {\n\n            if (c > total) { c = total; }\n            sc(`${Math.round(c / total * 10000) / 100}% (${c}/${total})`);\n\n            const toPromise: Promise<ApplLog[]>[] = [];\n            pages.forEach(page => toPromise.push(checkAllAppls(page, { sca: sca, ss: ss, config })));\n            await Promise.all(toPromise).then(localLogs => localLogs.flat().forEach(o => logs[o.appl_id] = o));\n            if (c % saveAt === 0) { runBtn.update(genLog(c, logs)); }\n\n            c += resize * config.limit;\n        }\n\n        runBtn.update(genLog(total, logs, true));\n        runBtn.enable();\n\n    }, [runBtn, config, resize, convert, saveAt, sca, ss, sc]);\n\n    const updateConfig = (e: React.ChangeEvent<HTMLInputElement>) => {\n        const id = e.target.id as keyof IApplConfig;\n        setConfig(prev => ({\n            ...prev,\n            [id]: !config[id],\n            limit: (e.target.checked) ? 100 : config.limit\n        }));\n    };\n\n    const updateLimit = (e: React.ChangeEvent<HTMLSelectElement>) => {\n        setConfig(prev => ({ ...prev, limit: Number(e.target.value) }));\n    };\n\n    const mschandler = (e: IMultiSelect<SSPVOCodeStatuses>) => {\n        setConfig(prev => ({ ...prev, filters: e.map(o => \"&filter_status=\" + o.id).join(\"\") }));\n    };\n\n    const needNewStatusHandler = (e: React.ChangeEvent<HTMLInputElement>) => {\n        if (!e.currentTarget.checked) {\n            setConfig(prev => ({ ...prev, newStatus: null }));\n        }\n        setNeedNewStatus(!needNewStatus);\n    };\n\n    const newStatusHandler = (e: ISingleSelect<SSPVOCodeStatuses>) => {\n        setConfig(prev => ({ ...prev, newStatus: e!.value }));\n    };\n\n    const mschandlerAppls = (e: IMultiSelect<applsChecks>) => {\n        if (e.length === 0) {\n            setConfig(prev => ({ ...prev, fullCheck: false }));\n        }\n        setConfig(prev => ({ ...prev, checks: e.map(o => o.value) }));\n    };\n\n    useEffect(() => {\n        if (config.fullCheck) {\n            setConfig(prev => ({\n                ...prev,\n                checks: defaultConfig.checks,\n                headers: true,\n                limit: 10\n            }));\n            setResize(1);\n        }\n    }, [config.fullCheck, setConfig, setResize]);\n\n    return (\n        <div className=\"main\">\n\n            <CheckBox id=\"onlySogl\" check={config.onlySogl} handler={updateConfig} text=\"Только Согласия\" />\n\n            <MultiSelect.GUStatuses handler={mschandler} defOpt={defaultFilters} />\n\n            <CheckBox id=\"needNewStatus\" check={needNewStatus} handler={needNewStatusHandler} text=\"Новый статус\" />\n            {needNewStatus && <SingleSelect.GUStatuses handler={newStatusHandler} />}\n\n            <CheckBox id=\"fullCheck\" check={config.fullCheck} handler={updateConfig} text=\"Полная выгрузка\" />\n            {config.fullCheck && <MultiSelect.ApplsChecks handler={mschandlerAppls} defOpt={defaultConfig.checks!} />}\n\n            <SimpleSelect.Limit value={config.limit} handler={updateLimit} />\n            <SimpleSelect.Save value={saveAt} setFunc={setSaveAt} />\n            <SimpleSelect.Split value={resize} setFunc={setResize} />\n\n            <CheckBox id=\"headers\" check={config.headers} handler={updateConfig} text=\"Названия столбцов\" />\n            {config.headers && <CheckBox id=\"toCSV\" check={convert} handler={() => setConvert(!convert)} text=\"Конвертировать в CSV\" />}\n\n            <MakeBtn p={runBtn.p} func={start} />\n\n            <p>Заявление: {currAbit}</p>\n            <p>Всего {counter}</p>\n            <p>Проверка: {status}</p>\n        </div>\n    );\n};\n\nexport default CheckAppls;"],"names":["disabledDefault","convertDefault","getZeroFunc","handlerFunc","type","useState","currAbit","sca","status","ss","counter","sc","saveAt","setSaveAt","resize","setResize","convert","setConvert","start","setStart","end","setEnd","runBtn","useBtn","defaultFilters","defaultConfig","fullCheck","headers","forceChange","onlySogl","limit","filters","newStatus","agree","checks","config","setConfig","needNewStatus","setNeedNewStatus","useRun","genZeroAppl","checkAllAppls","useEffect","prev","map","code","sspvo_statuses","o","id","join","document","title","useCallback","disable","remove","logs","getPages","total","count_page","totalPages","genArr","splitedPages","spliceIntoChunks","genLog","genUpdateFunc","c","pages","Math","round","toPromise","forEach","page","push","Promise","all","then","localLogs","flat","appl_id","update","enable","updateConfig","e","target","checked","className","check","handler","text","defOpt","currentTarget","value","length","Number","setFunc","p","func"],"sourceRoot":""}