{"version":3,"file":"static/js/639.6fe20133.chunk.js","mappings":"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","sources":["ts/fis.ts","pages/Fis2GU.tsx"],"sourcesContent":["import { IBaseFIO, IBaseLog, IConfig, ILogSubjectsCodeAbit, ILogSubjectsCodeGU, ISSPVOObj, RSS, subjectsCodeAll } from \"../models/common\";\nimport { Doc, IDocsAns } from \"../models/sspvo\";\nimport { getSubjectId } from \"./getBigFuncs\";\nimport { addLog, f, isNumber, makeForm, postDocs, getIdBySnilsOrFIO } from \"./utils\";\n\ninterface Iege {\n    [name: string]: {\n        year: number;\n        points: number;\n        valid: boolean;\n        region: number;\n    };\n}\n\ninterface FisAbit extends IBaseFIO {\n    series: string;\n    number: string;\n    ege: Iege;\n}\n\nexport interface FisAbits { [key: string]: FisAbit; }\n\nexport function convertFIS(data: string[][]): FisAbits | undefined {\n\n    const fisAbits: FisAbits = {};\n\n    for (const [i, fis] of data.filter(fis => fis.length > 10).entries()) {\n\n        let [surname, name, patronymic,\n            series, number,\n            subj, points, year, region, valid\n        ] = fis;\n\n        if (isNumber.non(surname, name, subj) && isNumber.only(year, points)) {\n\n            if (subj !== \"Сочинение\" && !subj.includes(\"устный\")) {\n\n                if (subj.includes(\"язык\") && subj !== \"Русский язык\") {\n                    // console.log(`${name} --> Иностранный язык`);\n                    subj = \"Иностранный язык - \" + subj.toLocaleLowerCase().split(\" \")[0];\n                }\n\n                if (series.length === 3) {\n                    series = `0${series}`;\n                }\n\n                const unicKey = surname + series + number;\n                const ege = { points: Number(points), year: Number(year), region: Number(region), valid: (valid === \"Действующий\") };\n\n                if (Object.hasOwn(fisAbits, unicKey)) {\n                    fisAbits[unicKey].ege[subj] = ege;\n                } else {\n                    fisAbits[unicKey] = {\n                        surname, name, patronymic,\n                        series, number,\n                        ege: { [subj]: ege }\n                    };\n                }\n            }\n        } else {\n            console.log(i, fis);\n            alert(`Строка ${i}\\nНекорректная выгрузка!\\n` +\n                \"Ожидалось [фамилия; имя; отчество; серия; номер; предмет; балл; год; регион; статус]\");\n            return;\n        }\n    };\n\n    return fisAbits;\n}\n\nexport interface ILogFIS extends IBaseLog, ILogSubjectsCodeAbit, ILogSubjectsCodeGU {\n    sspvo_id: number;\n    fis_series: string;\n    fis_number: string;\n    error_ege?: string;\n}\n\nfunction fillEgeLog(name: string, points: number, logObj: ILogFIS, isGU = false) {\n\n    let key = \"\" as subjectsCodeAll;\n\n    switch (name) {\n        case \"Русский язык\":\n            key = \"sum_r\";\n            break;\n        case \"Математика\":\n            key = \"sum_m\";\n            break;\n        case \"Информатика\":\n        case \"Информатика и ИКТ\":\n            key = \"sum_i\";\n            break;\n        case \"Физика\":\n            key = \"sum_p\";\n            break;\n        case \"Биология\":\n            key = \"sum_b\";\n            break;\n        case \"Обществознание\":\n            key = \"sum_o\";\n            break;\n        case \"Химия\":\n            key = \"sum_c\";\n            break;\n        case \"Иностранные языки\":\n        case \"Иностранный язык\":\n        case \"Иностранный язык - английский\":\n        case \"Иностранный язык - испанский\":\n        case \"Иностранный язык - китайский\":\n        case \"Иностранный язык - немецкий\":\n        case \"Иностранный язык - французский\":\n            key = \"sum_e\";\n            break;\n    }\n\n    if (key) {\n        logObj[(isGU ? \"gu_\" + key : key) as subjectsCodeAll] = points;\n    } else {\n        console.log(\"Не найден такой прдемет!\", name);\n    }\n}\n\nexport const useFIS = (config: IConfig, sa: RSS, ss: RSS) => {\n\n    const { get } = f;\n\n    async function checkFIS(abit: FisAbit): Promise<[number, ILogFIS]> {\n\n        const full_name = abit.surname + \" \" + abit.name + \" \" + abit.patronymic;\n        console.group(full_name);\n        sa(full_name);\n\n        const logObj: ILogFIS = {\n            sspvo_id: -1,\n            full_name: full_name,\n            snils: \"\",\n            surname: abit.surname,\n            name: abit.name,\n            patronymic: abit.patronymic,\n            gu_series: \"\",\n            gu_number: \"\",\n            fis_series: abit.series,\n            fis_number: abit.number,\n            passport_match: false,\n            sum_m: -1,\n            gu_sum_m: -1,\n            sum_r: -1,\n            gu_sum_r: -1,\n            sum_i: -1,\n            gu_sum_i: -1,\n            sum_p: -1,\n            gu_sum_p: -1,\n            sum_b: -1,\n            gu_sum_b: -1,\n            sum_c: -1,\n            gu_sum_c: -1,\n            sum_e: -1,\n            gu_sum_e: -1,\n            sum_o: -1,\n            gu_sum_o: -1,\n            error_gu_search: \"\",\n            error_passport: \"\",\n            error_ege: \"\"\n        };\n\n        const { sspvo_id, snils } = await getIdBySnilsOrFIO(logObj);\n\n        Object.entries(abit.ege).forEach(([name, { points }]) => fillEgeLog(name, points, logObj));\n\n        if (sspvo_id) {\n            logObj.sspvo_id = sspvo_id;\n            logObj.snils = snils;\n\n            ss(`Найден в базе ГУ ИТМО, id ${sspvo_id}`);\n\n            let sspvo: ISSPVOObj = {\n                passport: { exist: false, id: 0 },\n                attestat: { exist: false, id: 0, count: 0 },\n                ege: [],\n                egeFull: {}\n            };\n\n            const checkDoc = (doc: Doc) => {\n                switch (doc.id_document_type) {\n                    case 3:\n                        const exist = Object.hasOwn(sspvo.egeFull, doc.name_subject);\n                        ss(`Найден ЕГЭ: ${doc.name_subject}: ${doc.mark}`);\n                        if (!exist || (exist && doc.checked)) {\n                            sspvo.egeFull[doc.name_subject] = { id: doc.id, points: doc.mark || 0 };\n                            fillEgeLog(doc.name_subject, doc.mark || 0, logObj, true);\n                        }\n                        break;\n                    case 1:\n                    case 40:\n                        if (!logObj.passport_match || doc.checked) {\n                            console.log(\"Найден Паспорт\");\n                            ss(`Найден Паспорт, id ${doc.id}`);\n                            sspvo.passport.id = doc.id;\n                            sspvo.passport.exist = true;\n                            logObj.gu_series = doc.doc_series || \"\";\n                            logObj.gu_number = doc.doc_number || \"\";\n                            logObj.passport_match = (logObj.gu_series === logObj.fis_series && logObj.gu_number === logObj.fis_number);\n                        }\n                        break;\n                }\n            };\n\n            const passportAns = await get<IDocsAns>(`/api/entrants/${sspvo_id}/docs/short?categories=identification`);\n            if (passportAns.done) {\n                if (passportAns.data.length === 0) {\n                    addLog(logObj, \"error_passport\", \"Нет документов\");\n                } else {\n                    passportAns.data[0]?.docs?.forEach(checkDoc);\n                }\n            }\n\n            const docsAns = await get<IDocsAns>(`/api/entrants/${sspvo_id}/docs/short?no_categories=identification`);\n            if (docsAns.done) {\n\n                if (docsAns.data.length === 0) {\n                    addLog(logObj, \"error_ege\", \"Нет Аттестата, нет ЕГЭ\");\n                } else {\n                    docsAns.data[0]?.docs?.forEach(checkDoc);\n                }\n            }\n\n            if (sspvo.passport.exist && config.addEge) {\n                console.log(\"Что то с егэ\");\n                for (const [exam, data] of Object.entries(abit.ege)) {\n                    if (!sspvo.ege.includes(exam)) {\n                        console.log(\"Добавление\", exam);\n                        let formData = makeForm({\n                            id_region: data.region,\n                            id_subject: getSubjectId(exam),\n                            mark: data.points,\n                            result_date: `${data.year}-07-20`,\n                            id_entrant: sspvo_id,\n                            id_document_type: 3,\n                            id_ident_document: sspvo.passport.id,\n                            issue_date: `${data.year}-07-20`,\n                            doc_version: 47,\n                            doc_org: \"ФИС\",\n                            uid: `fis_${sspvo_id}_education_ege_${getSubjectId(exam)}_abit8`,\n                            doc_name: \"Результат ЕГЭ\"\n                        });\n                        const ege_id = await postDocs(\"/api/docs/add\", formData);\n                        sspvo.egeFull[exam] = { id: ege_id, points: data.points };\n                    }\n                };\n            }\n        }\n\n        console.groupEnd();\n        return [genUid(logObj), logObj];\n    }\n\n    const ZeroFIS = {\n        0: {\n            sspvo_id: \"id ГУ\",\n            full_name: \"ФИО\",\n            snils: \"снилс\",\n            surname: \"фамилия\",\n            name: \"имя\",\n            patronymic: \"отчество\",\n            gu_series: \"гу серия\",\n            gu_number: \"гу номер\",\n            fis_series: \"фис серия\",\n            fis_number: \"фис номер\",\n            passport_match: \"совпадает\",\n            sum_m: \"Математика\",\n            gu_sum_m: \"ГУ Математика\",\n            sum_r: \"Русский\",\n            gu_sum_r: \"ГУ Русский\",\n            sum_i: \"Информатика\",\n            gu_sum_i: \"ГУ Информатика\",\n            sum_p: \"Физика\",\n            gu_sum_p: \"ГУ Физика\",\n            sum_b: \"Биология\",\n            gu_sum_b: \"ГУ Биология\",\n            sum_c: \"Химия\",\n            gu_sum_c: \"ГУ Химия\",\n            sum_e: \"Иностранный\",\n            gu_sum_e: \"ГУ Иностранный\",\n            sum_o: \"Обществознание\",\n            gu_sum_o: \"ГУ Обществознание\",\n            error_gu_search: \"ошибка поиска на гу\",\n            error_passport: \"ошибка паспорта\",\n            error_ege: \"ошибка егэ\"\n        }\n    };\n\n    return { checkFIS, ZeroFIS };\n};\n\nfunction genUid(logObj: ILogFIS) {\n    const date = new Date();\n    return logObj.sspvo_id + Number(logObj.fis_number + logObj.fis_series) + date.getMilliseconds();\n}\n\nexport type ILogFullFis = { [key: number]: ILogFIS; };","import React, { useCallback, useState } from 'react';\nimport { genUpdateFunc, loadFiles, spliceIntoChunks } from \"../ts/utils\";\nimport { usePapaParse } from 'react-papaparse';\nimport { useFIS, convertFIS, FisAbits, ILogFullFis, ILogFIS } from \"../ts/fis\";\nimport { IConfig } from \"../models/common\";\nimport { MultiSelect, IMultiSelect } from \"../components/MultiSel\";\nimport { SSPVOCodeStatuses } from \"../models/sspvo\";\nimport useBtn from \"../hooks/btn.hook\";\nimport { CheckBox, SimpleSelect } from \"../components/SimpleSelect\";\nimport MakeBtn from \"../components/MakeBtn\";\nimport { ParseResult } from \"papaparse\";\n\nconst defaultConfig: IConfig = {\n    onlyAch: false,\n    addEge: false,\n    changeStatus: false,\n    searchInGUDB: false,\n    guStatuses: [\"in_competition\"],\n    guChecks: [\"agreement\", \"attestat\"],\n    abitConditions: [\"general_competition\", \"without_entry_tests\", \"by_unusual_quota\"]\n};\n\nconst Fis2GU: React.FC = () => {\n\n    const { readString } = usePapaParse();\n\n    const [fisAbits, setFisAbits] = useState<FisAbits>({});\n    const runBtn = useBtn(\"run\", \"RUN\");\n\n    const [currAbit, sa] = useState(\"\");\n    const [status, ss] = useState(\"\");\n    const [counter, sc] = useState(\"\");\n    const [saveAt, setSaveAt] = useState(50);\n    const [resize, setResize] = useState(5);\n    const [convert, setConvert] = useState(true);\n\n    const [config, setConfig] = useState(defaultConfig);\n    const { checkFIS, ZeroFIS } = useFIS(config, sa, ss);\n\n    const clear = () => {\n        runBtn.disable(false);\n        setFisAbits({});\n    };\n\n    const loadFilesFis = (event: React.ChangeEvent<HTMLInputElement>) => loadFiles(event, {\n        post: () => { },\n        then: (raw: string) => readString(raw, {\n            worker: true,\n            complete: (results: ParseResult<string[]>) => {\n                if (results.errors.length === 0) {\n                    const abits = convertFIS(results.data);\n                    if (abits) {\n                        setFisAbits(abits);\n                        runBtn.enable();\n                    } else {\n                        clear();\n                    }\n                } else {\n                    console.table(results.errors);\n                    alert(\"Неврный формат csv-файла!\\nСм. консоль\");\n                }\n            }\n        }),\n        empty: () => clear()\n    });\n\n    const start = useCallback(async () => {\n        sc(\"\");\n        runBtn.disable();\n        runBtn.remove();\n\n        const logs = ZeroFIS as unknown as ILogFullFis;\n        const genLog = genUpdateFunc(\"FisLog\", convert, resize);\n\n        const backs = Object.values(fisAbits);\n        const total = backs.length;\n        const splitedBacks = spliceIntoChunks(backs, resize);\n\n        let c = resize;\n\n        for (const abit of splitedBacks) {\n\n            if (c > total) { c = total; };\n            sc(`${Math.round(c / total * 10000) / 100}% (${c}/${total})`);\n\n            const toPromise: Promise<[number, ILogFIS]>[] = [];\n            abit.forEach(uno => toPromise.push(checkFIS(uno)));\n            await Promise.all(toPromise).then(localLogs => localLogs.forEach(([uid, log]) => logs[uid] = log));\n            if (c % saveAt === 0) { runBtn.update(genLog(c, logs)); }\n            c += resize;\n        }\n\n        runBtn.update(genLog(total, logs, true));\n        runBtn.enable();\n\n    }, [fisAbits, runBtn, resize, saveAt, convert, ZeroFIS, checkFIS]);\n\n    const mschandler = (e: IMultiSelect<SSPVOCodeStatuses>) => setConfig(prev => ({ ...prev, guStatuses: e.map(o => o.value) }));\n\n    return (\n        <div className=\"main\">\n            <input id=\"source\" type=\"file\" accept=\".csv\" onChange={loadFilesFis} />\n            <MultiSelect.GUStatuses handler={mschandler} defOpt={defaultConfig.guStatuses!} />\n            <SimpleSelect.Save value={saveAt} setFunc={setSaveAt} />\n            <SimpleSelect.Split value={resize} setFunc={setResize} />\n\n            <CheckBox id=\"toCSV\" check={convert} handler={e => setConvert(e.target.checked)} text=\"Конвертировать в CSV\" />\n            <MakeBtn p={runBtn.p} func={start} />\n            <p>Абитуриент: {currAbit}</p>\n            <p>Всего {counter}</p>\n            <p>{status}</p>\n        </div>\n    );\n};\n\nexport default Fis2GU;"],"names":["fillEgeLog","name","points","logObj","isGU","key","console","log","genUid","date","Date","sspvo_id","Number","fis_number","fis_series","getMilliseconds","defaultConfig","onlyAch","addEge","changeStatus","searchInGUDB","guStatuses","guChecks","abitConditions","readString","usePapaParse","useState","fisAbits","setFisAbits","runBtn","useBtn","currAbit","sa","status","ss","counter","sc","saveAt","setSaveAt","resize","setResize","convert","setConvert","config","setConfig","get","f","abit","full_name","surname","patronymic","group","snils","gu_series","gu_number","series","number","passport_match","sum_m","gu_sum_m","sum_r","gu_sum_r","sum_i","gu_sum_i","sum_p","gu_sum_p","sum_b","gu_sum_b","sum_c","gu_sum_c","sum_e","gu_sum_e","sum_o","gu_sum_o","error_gu_search","error_passport","error_ege","getIdBySnilsOrFIO","Object","entries","ege","forEach","sspvo","passport","exist","id","attestat","count","egeFull","checkDoc","doc","id_document_type","hasOwn","name_subject","mark","checked","doc_series","doc_number","passportAns","done","data","length","addLog","docs","docsAns","exam","includes","formData","makeForm","id_region","region","id_subject","getSubjectId","result_date","year","id_entrant","id_ident_document","issue_date","doc_version","doc_org","uid","doc_name","postDocs","ege_id","groupEnd","checkFIS","ZeroFIS","useFIS","clear","disable","start","useCallback","remove","logs","genLog","genUpdateFunc","backs","values","total","splitedBacks","spliceIntoChunks","c","Math","round","toPromise","uno","push","Promise","all","then","localLogs","update","enable","className","type","accept","onChange","event","loadFiles","post","raw","worker","complete","results","errors","abits","filter","fis","i","subj","valid","isNumber","alert","toLocaleLowerCase","split","unicKey","convertFIS","table","empty","MultiSel","handler","e","prev","map","o","value","defOpt","SimpleSelect","setFunc","check","target","text","MakeBtn","p","func"],"sourceRoot":""}